# SystemDesign

# 1. ER - модель + DB arch struct.
Схема ER-модели и структура базы данных доступны в https://miro.com/app/board/uXjVIT1TleE=/   
# 2. Функциональные и нефункциональные требования.   
### 2.1. Функциональные требования:  
- Добавление и удаление друзей;    
- Просмотр друзей пользователя;    
- Просмотр анкеты пользователя;  
- Публикация поста в ленту;  
- Загрузка медиа файлов для постов;  
- Просмотр ленты постов (домашней и пользователей);  
- Просмотр диалогов и чатов пользователя;  
- Отправка и чтение сообщений в диалогах и чатах;  
### 2.2. Нефункциональные требования:  
- Поддержка пользователей только из СНГ;  
- Лимит на сообщения - 15_000_000;  
- Максимальная длина личного сообщения - 4096 знака;  
- Максимальное количество польщователей в 1м чате - 500;  
- Максимальный размер поста – 15895 знаков;  
- Лимит на посты - 5_000_000;  
- Максимальное количество фотоальбомов в профиле — 2000;   
- Максимальное количество фотографий в одном альбоме — 10000;  
- Максимальное размер фотографии — 25МБ;  
- Максимальное количество видеозаписей на странице – 5000 видеозаписей;   
- Максимальный размер загружаемой видеозаписи – 256 Гб;  
- Максимальный размер файла, сохраняемого в раздел «Документы» — 2 Гб;  
- Максимум аудиозаписей на странице (корректное отображение) – 6000 аудиозаписей;  
- Максимальный размер аудиозаписи – 200 Мб;  
### 2.3. Среднестатистические требования:  
- В среднем, пользователь пишет порядка 150 сообщений в день;  
- В среднем, пользователь читает порядка 450 сообщений в день;  
- В среднем, пользователь ВК хранит порядка 300 фото;  

# 3. Размер базы данных для хранения файлов и сообщений на 5 лет.
DAU = 56,5 млн. пользователей;  
MAU = 88,3 млн. пользователей;  

RPS(write) = 56_500_000 * 150 / 86400 = 98_090 (r/s)  
RPS (read) = 2_354_167 * 3 = 294_270 (r/s)  

TrafficMessage(write) = 98_090 * 4096 * 2 = 767 (MB/s)  
TrafficMessage(read) = 767 * 3 = 2301 (MB/s)  
Traffic per day Message(write) = 767 * 86400 = 63 (TB/s)   
Traffic per year Message(write) = 63 * 365 = 23 (PB/s)  
Traffic for 5 year Message(write) = 5 * 63 = 315 (PB/s)  

Initial storage capacity for msg =  315 PB  
Initial storage capacity for msg with replication factor x3 = 945 PБ  
HDD disk = 20TB  

Count of hdd for msg = 945 * 1024 / 20 =  48_384 (шт)   
Count of shards for msg = 48_384 / 12 = 4032  (шардов)    

Initial storage for photo = 56_500_000 * 300 * 0,5 (Mb) = 8 PB  
Initial storage capacity for photo with replication factor x3 =  24 PБ  
HDD disk = 20TB

Count of hdd for photo = 24 * 1024 / 20 = 1229 (шт)  
Count of shards for photo = 1229 / 12 = 103 шародов  

SUM HDD (msg and photo) = 48_384 + 1229 = 49_613 
SUM SHARDS (msg and photo) = 4032 + 103 = 4135  
